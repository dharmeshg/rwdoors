!function(t,e){"use strict";e.utilites.namespace("tmAdminNotice"),e.tmAdminNotice={noticeCreate:function(e,s,a){function i(){var e=100;t(".cherry-handler-notice").each(function(){t(this).css({top:e}),e+=t(this).outerHeight(!0)})}var n,r,d=0,o=a||!1;return s&&"true"!==o?(n=t('<div class="cherry-handler-notice '+e+'"><span class="dashicons"></span><div class="inner">'+s+"</div></div>"),t("body").prepend(n),i(),d=-1*(n.outerWidth(!0)+10),n.css({right:d}),r=setTimeout(function(){n.css({right:10}).addClass("show-state")},100),r=setTimeout(function(){d=-1*(n.outerWidth(!0)+10),n.css({right:d}).removeClass("show-state")},15e3),void(r=setTimeout(function(){n.remove(),clearTimeout(r)},15500))):!1}},e.utilites.namespace("rateForm"),e.rateForm={ajaxInstance:null,handlerId:"tm_rate_form_id",formId:"#tm-rateform",fieldClass:".tm-rate-form__field",buttonClass:".tm-rate-form__btn",init:function(){window[this.handlerId]&&(this.ajaxInstance=new e.CherryAjaxHandler({handlerId:this.handlerId,successCallback:this.sendSuccessCallback.bind(this)}),this.validateRateForm())},validateRateForm:function(){if(!t.isFunction(jQuery.fn.validate)||!t(this.formId).length)return!1;var e=this;t(this.formId).validate({debug:!0,errorElement:"span",rules:{tm_rate_title:{minlength:3}},submitHandler:function(){e.sendReviewHandler()}})},sendReviewHandler:function(){this.disableButton(this.buttonClass),this.ajaxInstance.sendFormData(this.formId)},sendSuccessCallback:function(t){!0===t.data.success?this.enableButton(this.buttonClass,"success"):(this.enableButton(this.buttonClass,"error"),t.message=this.ajaxInstance.handlerSettings.sys_messages.invalid_base_data,t.type="error-notice")},disableButton:function(e){t(e).attr("disabled","disabled").addClass("processing")},enableButton:function(e,s){var a=null;t(e).removeAttr("disabled").removeClass("processing").addClass(s),t(this.formId)[0].reset(),t(this.fieldClass).removeClass("valid"),a=setTimeout(function(){t(e).removeClass(s),clearTimeout(a)},1e3)}},e.utilites.namespace("verifiedTheme"),e.verifiedTheme={verifiedThemeId:"tm_verified_theme",themeForm:".tm-updates__theme-form",themeFormControls:".tm-updates__theme-form-controls",submiteButton:".verified-theme",errorClass:".error-field",verifiedTheme:null,init:function(){window[this.verifiedThemeId]&&(this.verifiedTheme=new e.CherryAjaxHandler({handlerId:this.verifiedThemeId,successCallback:this.checkVerifiedThemeCallback.bind(this)}),this.addEvents())},addEvents:function(){t(this.themeForm).on("click",this.submiteButton,this.checkVerifiedTheme.bind(this)).on("click",this.errorClass,this.removeErrorClass.bind(this))},checkVerifiedTheme:function(e){var s,a,i=e.target,n=t(e.delegateTarget);return this.disableButton(i),s=n.serializeArray(),(a=this.validateForm(s))?(t(a,n).addClass("error-field"),this.enableButton(i,"error"),!1):(t(".utb-js").not(i).attr("disabled","disabled").addClass("disabled"),this.verifiedTheme.sendData(s),!1)},validateForm:function(t){for(var e,s,a=t.length-1,i="";a>=0;a--)e=t[a].value,s=t[a].name,e||(i+=',[name="'+s+'"]');return i=i.replace(/^,/,"")},removeErrorClass:function(e){var s=t(e.target),a=this.errorClass.replace(/^\./,"");s.removeClass(a)},checkVerifiedThemeCallback:function(s){var a=s.data,i=t("#"+a.slug),n=t(this.submiteButton,i),r=t(this.themeFormControls,i),d=a.htmlForm;return t(".utb-js").removeAttr("disabled").removeClass("disabled"),a.verify?(d&&r.removeClass("show-form").addClass("hide-form").on("animationend",this.showControls.bind(this,r,d)),e.tmAdminNotice.noticeCreate("success-notice",a.message),this.enableButton(t(n,i),"success"),!1):(e.tmAdminNotice.noticeCreate("error-notice",a.message),this.enableButton(n,"error"),!1)},showControls:function(t,e){t.html(e).removeClass("hide-form").addClass("show-form")},disableButton:function(e){t(e).attr("disabled","disabled").addClass("processing")},enableButton:function(e,s){var a=null;t(e).removeAttr("disabled").removeClass("processing").addClass(s),a=setTimeout(function(){t(e).removeClass(s),clearTimeout(a)},1e3)}},e.utilites.namespace("updateTheme"),e.updateTheme={ajaxBackupId:"tm_theme_backup",ajaxBackupHandler:null,ajaxUpdateId:"tm_update_theme",ajaxUpdateHandler:null,sectionClass:".tm-updates__theme",wrapClass:".tm-updates__theme-wrap",themeForm:".tm-updates__theme-form",submiteButton:".tm-update-theme",continueUpdateButton:"#update-theme-continue",popUp:"#tm-dashboard-update-popup",popUpBg:".tm-dashboard-popup__background",closePopUpButton:"#update-theme-cancel",themeImage:".tm-updates__theme-image",imageLable:".tm-notification-image-label",processClass:"tm-dashboard-processing",errorClass:".error-field",tempData:null,init:function(){window[this.ajaxBackupId]&&(this.ajaxBackupHandler=new e.CherryAjaxHandler({handlerId:this.ajaxBackupId,successCallback:this.ajaxBackupHandlerCallback.bind(this)})),window[this.ajaxUpdateId]&&(this.ajaxUpdateHandler=new e.CherryAjaxHandler({handlerId:this.ajaxUpdateId,successCallback:this.ajaxUpdateHandlerCallback.bind(this)})),this.addEvents()},addEvents:function(){t(this.themeForm).on("click",this.submiteButton,this.checkUpdateTheme.bind(this)),t("body").on("click.tm-update",this.popUpBg,this.cancelUpdate.bind(this)).on("click.tm-update",this.closePopUpButton,this.cancelUpdate.bind(this)).on("click.tm-update",this.continueUpdateButton,this.startUpdate.bind(this))},checkUpdateTheme:function(e){var s=e.target,a=t(e.delegateTarget),i={slug:a.attr("name"),version:t('[name="version"]',a).val(),updateVersion:t('[name="update-version"]',a).val()},n=a.data("autoBackup").toString();return this.tempData=i,this.disableButton(s),t(".tm-updates").addClass(this.processClass),t(".utb-js").not(s).attr("disabled","disabled").addClass("disabled"),"true"==n?this.startUpdate(e):(t(this.popUp).addClass("show open"),t(window).one("keyup",this.cancelUpdate.bind(this))),!1},startUpdate:function(e){var s,a=t(e.delegateTarget),i=a.data("autoBackup");return this.tempData?this.ajaxBackupHandler.sendData(this.tempData.slug):(this.tempData=null,s=t("#check-theme-"+this.tempData.slug),this.enableButton(s,"error")),"true"!=i&&this.hidePopUp(),!1},cancelUpdate:function(e){if("keyup"===e.type&&27!==e.keyCode)return!1;if(!this.tempData)return!1;var s=t("#check-theme-"+this.tempData.slug);return this.tempData=null,this.hidePopUp(),this.enableButton(s,"error"),t(".tm-updates").removeClass(this.processClass),t(".utb-js").removeAttr("disabled").removeClass("disabled"),!1},hidePopUp:function(){t(this.popUp).removeClass("open"),t(".tm-dashboard-popup__inner",this.popUp).one("animationend",this.hidePopUpWrapper.bind(this))},hidePopUpWrapper:function(){t(this.popUp).removeClass("show")},ajaxBackupHandlerCallback:function(e){var s=t("#"+e.data.target),a=t(this.submiteButton,s),i=t('[data-themename="'+e.data.target+'"]',t(this.sectionClass)),n=wp.template("new-backup-template");!0===e.data.success?(i.prepend(n({name:e.data.extra.name,date:e.data.extra.date,version:e.data.extra.version})).removeClass("hide"),this.ajaxUpdateHandler.sendData(this.tempData),this.tempData=null):(e.message=this.ajaxBackupHandler.handlerSettings.sys_messages.invalid_base_data,e.type="error-notice",this.enableButton(a,"error"),t(".tm-updates").removeClass(this.processClass),t(".utb-js").removeAttr("disabled").removeClass("disabled"))},ajaxUpdateHandlerCallback:function(s){var a,i=s.data,n=t("#"+i.slug),r=(t(this.themeFormControls,n),t(this.submiteButton,n)),d=n.closest(this.wrapClass).siblings(this.themeImage).find(this.imageLable);return t(".tm-updates").removeClass(this.processClass),t(".utb-js").removeAttr("disabled").removeClass("disabled"),!0===i.error?(this.enableButton(r,"error"),e.tmAdminNotice.noticeCreate("error-notice",i.message),!1):(t(".current-version",n).html(i.updateVersion),this.enableButton(r,"success"),e.tmAdminNotice.noticeCreate("success-notice",i.message),void(a=setTimeout(function(){r.addClass("disabled").attr("disabled","disabled"),d.remove(),clearTimeout(a)},1e3)))},removeErrorClass:function(e){var s=t(e.target),a=this.errorClass.replace(/^\./,"");s.removeClass(a)},disableButton:function(e){t(e).attr("disabled","disabled").addClass("processing")},enableButton:function(e,s){var a=null;t(e).removeAttr("disabled").addClass(s).removeClass("utb-js processing"),a=setTimeout(function(){t(e).removeClass(s),clearTimeout(a)},1e3)}},e.utilites.namespace("createBackup"),e.createBackup={ajaxInstance:null,handlerId:"tm_theme_backup",sectionClass:".tm-updates__theme",themeNameClass:".tm-backup-theme-name",buttonClass:".tm-backup-theme-btn",buttonId:"#tm-backup-theme-btn-",statusClass:"tm-dashboard-table__tr--adding",processClass:"tm-dashboard-processing",init:function(){window[this.handlerId]&&(this.ajaxInstance=new e.CherryAjaxHandler({async:!0,handlerId:this.handlerId,successCallback:this.successCallback.bind(this)}),this.addEvents())},addEvents:function(){t(this.buttonClass).on("click","button",this.sendHandler.bind(this))},sendHandler:function(e){var s=t(e.target),a=s.attr("form"),i=t("#"+a),n=t(this.themeNameClass,i).val();i.closest(this.sectionClass).addClass(this.processClass),this.disableButton(e.target),this.ajaxInstance.sendData(n)},successCallback:function(e){var s=this.buttonId+e.data.target,a=t('[data-themename="'+e.data.target+'"]',t(this.sectionClass)),i=wp.template("new-backup-template");a.closest(this.sectionClass).removeClass(this.processClass),!0===e.data.success?(this.enableButton(s,"success"),a.prepend(i({name:e.data.extra.name,date:e.data.extra.date,version:e.data.extra.version})).removeClass("hide")):(this.enableButton(s,"error"),e.message=this.ajaxInstance.handlerSettings.sys_messages.invalid_base_data,e.type="error-notice")},disableButton:function(e){t(e).attr("disabled","disabled").addClass("processing")},enableButton:function(e,s){var a=null;return t(e).length?(t(e).removeAttr("disabled").removeClass("processing").addClass(s),void(a=setTimeout(function(){t(e).removeClass(s),clearTimeout(a)},1e3))):!1}},e.utilites.namespace("saveBackupOptions"),e.saveBackupOptions={ajaxInstance:null,handlerId:"tm_backup_settings",sectionClass:".tm-updates__theme",buttonClass:".tm-backup-schedule-wrap--save-control",buttonId:"#tm-backup-save-btn-",processClass:"tm-dashboard-processing",init:function(){window[this.handlerId]&&(this.ajaxInstance=new e.CherryAjaxHandler({handlerId:this.handlerId,successCallback:this.successCallback.bind(this)}),this.addEvents())},addEvents:function(){t(this.buttonClass).on("click","button",this.sendHandler.bind(this))},sendHandler:function(e){var s=t(e.target).attr("form"),a="#"+s;t(a).closest(this.sectionClass).addClass(this.processClass),this.disableButton(e.target),this.ajaxInstance.sendFormData(a)},successCallback:function(e){var s=this.buttonId+e.data.target;t(s).closest(this.sectionClass).removeClass(this.processClass),!0===e.data.success?(this.enableButton(s,"success"),this.setDataAtts(e.data)):(this.enableButton(s,"error"),e.message=this.ajaxInstance.handlerSettings.sys_messages.invalid_base_data,e.type="error-notice")},setDataAtts:function(e){var s,a;return!1===e.extra?!1:(s=t("#"+e.target),a=t('[data-themename="'+e.target+'"]',t(this.sectionClass)),s.data("autoBackup",e.extra["auto-backup"]),void a.data("backupLimit",e.extra.limit))},disableButton:function(e){t(e).attr("disabled","disabled").addClass("processing")},enableButton:function(e,s){var a=null;return t(e).length?(t(e).removeAttr("disabled").removeClass("processing").addClass(s),void(a=setTimeout(function(){t(e).removeClass(s),clearTimeout(a)},1e3))):!1}},e.utilites.namespace("restoreBackup"),e.restoreBackup={tempData:null,ajaxInstance:null,handlerId:"tm_theme_restore",sectionClass:".tm-updates",tableClass:".tm-dashboard-table",buttonClass:".tm-dashboard-action-btn--restore",popUp:"#tm-dashboard-restore-popup",popUpInner:".tm-dashboard-popup__inner",popUpBg:".tm-dashboard-popup__background",restoreForm:"#tm-restore-form",restoreStart:"#tm-dashboard-restore-start",restoreCancel:"#tm-dashboard-restore-cancel",restoreSettings:".cherry-checkbox-label, .cherry-checkbox-item",waitClass:"tm-dashboard-action-btn--wait",statusClass:"tm-dashboard-table__tr--restoring",processClass:"tm-dashboard-processing",init:function(){window[this.handlerId]&&(this.ajaxInstance=new e.CherryAjaxHandler({async:!0,handlerId:this.handlerId,successCallback:this.successCallback.bind(this)}),this.addEvents())},addEvents:function(){t(this.tableClass).on("click",this.buttonClass,this.sendHandler.bind(this)),t(this.restoreForm).on("click",this.restoreStart,this.startRestore.bind(this)).on("click",this.restoreCancel,this.cancelRestore.bind(this)).on("change",".cherry-checkbox-input",this.toggleStartBtn.bind(this)),t("body").on("click",this.popUpBg,this.cancelRestore.bind(this))},sendHandler:function(e){var s=t(e.target),a=s.closest(this.tableClass),i=s.closest("tr");this.tempData={themeName:a.data("themename"),archiveName:i.data("archivename"),isAutoBackup:i.data("autobackup")},t(this.sectionClass).addClass(this.processClass),i.addClass(this.statusClass),s.addClass(this.waitClass),t(this.popUp).addClass("show open")},startRestore:function(){var s=e.cherryHandlerUtils.serializeObject(t(this.restoreForm));s?(this.tempData.settings=s["tm-restore-settings"],this.ajaxInstance.sendData(this.tempData)):(this.end(this.tempData.archiveName),this.tempData=null),this.hidePopUp()},cancelRestore:function(t){return"keyup"===t.type&&27!==t.keyCode?!1:this.tempData?(this.end(this.tempData.archiveName),this.hidePopUp(),void(this.tempData=null)):!1},toggleStartBtn:function(){var e=t(".cherry-checkbox-input",t(this.restoreForm));t(this.restoreStart).prop("disabled",e.filter(":checked").length<1)},end:function(e){var s=t('[data-archivename="'+e+'"]',t(this.tableClass)),a=t("."+this.waitClass,s);t(this.sectionClass).removeClass(this.processClass),s.removeClass(),a.removeClass(this.waitClass)},hidePopUp:function(){t(this.popUp).removeClass("open"),t(this.popUpInner,this.popUp).one("animationend",this.hidePopUpWrapper.bind(this))},hidePopUpWrapper:function(){t(this.popUp).removeClass("show")},successCallback:function(t){this.end(t.data.target),!0===t.data.success?this.changeThemeVersion(t.data.target):(t.message=t.data.empty_settings?this.ajaxInstance.handlerSettings.sys_messages.empty_settings:this.ajaxInstance.handlerSettings.sys_messages.invalid_base_data,t.type="error-notice")},changeThemeVersion:function(e){var s=e.split("__"),a=t("#"+s[0]),i=t(".current-version",a),n=t(".tm-update-theme",a),r=s[1].slice(1),d=t('[name="update-version"]',a).val(),o=this.versionCompare(r,d);i.length>0&&i.html(r),-1===o&&n.length>0?n.removeClass("disabled").removeAttr("disabled","disabled"):(n.addClass("disabled").attr("disabled","disabled"),a.closest(".tm-updates__theme-wrap").siblings(".tm-updates__theme-image").find(".tm-notification-image-label").remove())},versionCompare:function(t,e){if(typeof t+typeof e!="stringstring")return!1;for(var s=t.split("."),a=e.split("."),i=0,n=Math.max(s.length,a.length);n>i;i++){if(s[i]&&!a[i]&&parseInt(s[i])>0||parseInt(s[i])>parseInt(a[i]))return 1;if(a[i]&&!s[i]&&parseInt(a[i])>0||parseInt(s[i])<parseInt(a[i]))return-1}return 0}},e.utilites.namespace("deleteBackup"),e.deleteBackup={ajaxInstance:null,handlerId:"tm_backup_delete",sectionClass:".tm-updates__theme",tableClass:".tm-dashboard-table",buttonClass:".tm-dashboard-action-btn--delete",waitClass:"tm-dashboard-action-btn--wait",statusClass:"tm-dashboard-table__tr--removing",processClass:"tm-dashboard-processing",init:function(){window[this.handlerId]&&(this.ajaxInstance=new e.CherryAjaxHandler({async:!0,handlerId:this.handlerId,successCallback:this.successCallback.bind(this)}),this.addEvents())},addEvents:function(){t(this.tableClass).on("click",this.buttonClass,this.sendHandler.bind(this))},sendHandler:function(e){var s=t(e.target),a=s.closest("tr"),i=a.closest(this.tableClass);return window.confirm(tmDashbordVars.messages.deleteBackup)?(i.closest(this.sectionClass).addClass(this.processClass),a.addClass(this.statusClass),s.addClass(this.waitClass),void this.ajaxInstance.sendData({themeName:i.data("themename"),archiveName:a.data("archivename"),isAutoBackup:a.data("autobackup")})):!1},successCallback:function(e){var s=t('[data-archivename="'+e.data.target+'"]',t(this.tableClass)),a=t("."+this.waitClass,s),i=s.closest(this.tableClass);s.closest(this.sectionClass).removeClass(this.processClass),a.removeClass(this.waitClass),!0===e.data.success?(this.deleteRow(s),!0===e.data.empty&&i.addClass("hide")):(e.message=this.ajaxInstance.handlerSettings.sys_messages.invalid_base_data,e.type="error-notice")},deleteRow:function(t){return t.length?void t.fadeOut(400,function(){this.remove()}):!1}},e.utilites.namespace("downloadBackup"),e.downloadBackup={ajaxInstance:null,handlerId:"tm_backup_download",sectionClass:".tm-updates__theme",tableClass:".tm-dashboard-table",buttonClass:".tm-dashboard-action-btn--download",waitClass:"tm-dashboard-action-btn--wait",statusClass:"tm-dashboard-table__tr--downloading",processClass:"tm-dashboard-processing",init:function(){window[this.handlerId]&&(this.ajaxInstance=new e.CherryAjaxHandler({async:!0,handlerId:this.handlerId,successCallback:this.successCallback.bind(this)}),this.addEvents())},addEvents:function(){t(this.tableClass).on("click",this.buttonClass,this.sendBackupHandler.bind(this))},sendBackupHandler:function(e){var s=t(e.target),a=s.closest("tr"),i=a.closest(this.tableClass);i.closest(this.sectionClass).addClass(this.processClass),a.addClass(this.statusClass),s.addClass(this.waitClass),this.ajaxInstance.sendData({themeName:i.data("themename"),archiveName:a.data("archivename"),isAutoBackup:a.data("autobackup")})},successCallback:function(e){var s=t('[data-archivename="'+e.data.target+'"]',t(this.tableClass));s.removeClass().find("."+this.waitClass).removeClass(this.waitClass).closest(this.sectionClass).removeClass(this.processClass),!0===e.data.success?window.location=e.data.url:(e.message=this.ajaxInstance.handlerSettings.sys_messages.invalid_base_data,e.type="error-notice")}},e.utilites.namespace("togglePanel"),e.togglePanel={panelClass:".tm-updates__theme",buttonClass:".tm-dashboard-toggle-backup-section",toggleClass:"tm-dashboard-toggle-backup-section--hide",init:function(){this.addEvents()},addEvents:function(){t(this.panelClass).on("click",this.buttonClass,this.sendBackupHandler.bind(this))},sendBackupHandler:function(e){t(e.target).toggleClass(this.toggleClass)}},e.rateForm.init(),e.updateTheme.init(),e.verifiedTheme.init(),e.createBackup.init(),e.saveBackupOptions.init(),e.restoreBackup.init(),e.deleteBackup.init(),e.downloadBackup.init(),e.togglePanel.init()}(jQuery,window.CherryJsCore);